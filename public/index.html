<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zerowatch Official Hero Bans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .hero-card { transition: transform 0.2s, filter 0.2s; cursor: pointer; }
        .hero-card:hover { transform: scale(1.05); }
        .banned { filter: grayscale(100%) opacity(0.5); pointer-events: none; }
    </style>
</head>
<body class="p-8 text-center flex flex-col items-center min-h-screen">

    <h1 class="text-5xl font-bold text-orange-500 mb-2 uppercase tracking-widest">Zerowatch</h1>
    <h2 class="text-xl text-gray-400 mb-8 uppercase tracking-widest">Official Hero Bans</h2>

    <div id="app" class="w-full max-w-4xl">
        </div>

    <script>
        const socket = io();
        const appDiv = document.getElementById('app');
        
        // Web Audio API for synthetic sounds (No external files needed!)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTurnSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
            osc.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        function playTickSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        // Expanded Roster (You can add the rest!)
        const heroes = ["Ana", "Ashe", "Baptiste", "Cassidy", "D.Va", "Doomfist", "Genji", "Kiriko", "Lucio", "Mercy", "Reinhardt", "Tracer", "Widowmaker", "Winston"];
        
        let localState = {};
        let myId = null;
        let lastTimer = 60;

        socket.on('connect', () => { myId = socket.id; });

        socket.on('state_update', (state) => {
            localState = state;
            render();

            // Handle ticking sound
            if (state.phase === 'banning' && state.timer <= 10 && state.timer !== lastTimer) {
                playTickSound();
            }
            lastTimer = state.timer;
        });

        function joinAsCaptain() {
            const name = document.getElementById('teamName').value || 'Captain';
            audioCtx.resume(); // Unlock audio on user interaction
            socket.emit('join_captain', name);
        }

        function banHero(heroName) {
            if (localState.turn === myId) {
                socket.emit('ban_hero', heroName);
            }
        }

        function render() {
            if (localState.phase === 'waiting') {
                appDiv.innerHTML = `
                    <div class="bg-slate-800 p-8 rounded-lg shadow-xl">
                        <h3 class="text-2xl mb-4">Waiting for Captains... (${localState.players?.length || 0}/2)</h3>
                        ${!localState.players?.find(p => p.id === myId) ? `
                            <input type="text" id="teamName" placeholder="Enter Team Name" class="p-2 rounded text-black mb-4">
                            <button onclick="joinAsCaptain()" class="bg-orange-600 hover:bg-orange-500 text-white font-bold py-2 px-4 rounded">Join as Captain</button>
                        ` : `<p class="text-green-400">You are in. Waiting for opponent...</p>`}
                    </div>
                `;
            } 
            else if (localState.phase === 'banning') {
                const isMyTurn = localState.turn === myId;
                const turnPlayer = localState.players.find(p => p.id === localState.turn);
                
                // Play sound if it just became my turn
                if (isMyTurn && lastTimer === 60) playTurnSound();

                let html = `
                    <div class="mb-6">
                        <h3 class="text-3xl font-bold ${isMyTurn ? 'text-green-400' : 'text-red-400'}">
                            ${isMyTurn ? 'YOUR TURN TO BAN!' : `Waiting for ${turnPlayer.name}...`}
                        </h3>
                        <div class="text-5xl font-mono mt-2 ${localState.timer <= 10 ? 'text-red-500 animate-pulse' : 'text-white'}">${localState.timer}s</div>
                    </div>
                    <div class="flex justify-center gap-4 mb-8">
                        <p>Bans so far: ${localState.bans.length}/4</p>
                    </div>
                    <div class="grid grid-cols-4 md:grid-cols-7 gap-4">
                `;

                heroes.forEach(hero => {
                    const isBanned = localState.bans.find(b => b.hero === hero);
                    // Using UI Avatars for dynamic placeholders. Replace URL with your actual Overwatch image assets.
                    const imgUrl = `https://ui-avatars.com/api/?name=${hero}&background=random&color=fff&size=128`;
                    
                    html += `
                        <div class="hero-card ${isBanned ? 'banned' : ''}" onclick="banHero('${hero}')">
                            <img src="${imgUrl}" alt="${hero}" class="rounded-lg border-2 border-slate-700 w-full">
                            <p class="mt-1 text-sm font-semibold">${hero}</p>
                        </div>
                    `;
                });
                html += `</div>`;
                appDiv.innerHTML = html;
            }
            else if (localState.phase === 'finished') {
                // Deduplicate bans using a Set
                const uniqueBans = [...new Set(localState.bans.map(b => b.hero))];
                
                let html = `
                    <div class="bg-slate-800 p-8 rounded-lg shadow-xl">
                        <h3 class="text-4xl text-orange-500 font-bold mb-6 border-b border-gray-600 pb-4">FINAL BANNED HEROES</h3>
                        <div class="flex justify-center gap-8 mt-6">
                `;

                uniqueBans.forEach(hero => {
                    const imgUrl = `https://ui-avatars.com/api/?name=${hero}&background=random&color=fff&size=128`;
                    html += `
                        <div class="text-center">
                            <img src="${imgUrl}" alt="${hero}" class="rounded-full border-4 border-red-600 w-32 h-32 mx-auto shadow-[0_0_15px_rgba(220,38,38,0.7)]">
                            <p class="mt-3 text-xl font-bold text-gray-200">${hero}</p>
                        </div>
                    `;
                });

                html += `</div></div>`;
                appDiv.innerHTML = html;
            }
        }
    </script>
</body>
</html>
